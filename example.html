<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PinchZoom 라이브러리 - 포괄적인 예제</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        line-height: 1.6;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 20px 0;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        text-align: center;
      }

      .header h1 {
        margin: 0;
        color: #333;
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        margin: 10px 0 0 0;
        color: #666;
        font-size: 1.1rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      .section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        margin-bottom: 40px;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .section:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      }

      .section-header {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 20px 30px;
        margin: 0;
      }

      .section-header h2 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .section-header p {
        margin: 5px 0 0 0;
        opacity: 0.9;
        font-size: 0.95rem;
      }

      .section-content {
        padding: 30px;
      }

      .demo-image {
        width: 100%;
        max-width: 500px;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        transition: all 0.3s ease;
        display: block;
        margin: 0 auto;
      }

      .demo-image:hover {
        transform: scale(1.02);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      }

      .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-top: 25px;
      }

      .gallery-item {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .gallery-item:hover {
        transform: translateY(-3px);
      }

      .gallery img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .gallery img:hover {
        transform: scale(1.05);
      }

      .controls {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 12px;
        margin: 25px 0;
        border: 1px solid #e9ecef;
      }

      .controls h3 {
        margin: 0 0 20px 0;
        color: #333;
        font-size: 1.2rem;
      }

      .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
      }

      .btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #218838;
        transform: translateY(-2px);
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        background: #e0a800;
        transform: translateY(-2px);
      }

      .btn-info {
        background: #17a2b8;
        color: white;
      }

      .btn-info:hover {
        background: #138496;
        transform: translateY(-2px);
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background: #c82333;
        transform: translateY(-2px);
      }

      .status {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 14px;
        line-height: 1.5;
        min-height: 50px;
      }

      .status.success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }

      .status.error {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }

      .status.warning {
        background: #fff3cd;
        border-color: #ffeaa7;
        color: #856404;
      }

      .status.info {
        background: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
      }

      .code-example {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 14px;
        overflow-x: auto;
      }

      .code-example pre {
        margin: 0;
        white-space: pre-wrap;
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin: 25px 0;
      }

      .feature-card {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 25px;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .feature-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .feature-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        display: block;
      }

      .feature-card h3 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 1.2rem;
      }

      .feature-card p {
        margin: 0;
        color: #666;
        font-size: 0.95rem;
      }

      .error-demo {
        background: #fff5f5;
        border: 2px dashed #fed7d7;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        color: #c53030;
        margin: 15px 0;
      }

      .responsive-demo {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .responsive-demo img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .responsive-demo img:hover {
        transform: scale(1.05);
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .container {
          padding: 20px 15px;
        }

        .section-content {
          padding: 20px;
        }

        .button-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-content">
        <h1>🔍 PinchZoom</h1>
        <p>
          Instagram과 같은 핀치 줌 기능을 제공하는 바닐라 JavaScript 라이브러리
        </p>
      </div>
    </div>

    <div class="container">
      <!-- 기능 소개 섹션 -->
      <div class="section">
        <div class="section-header">
          <h2>✨ 주요 기능</h2>
          <p>PinchZoom 라이브러리의 핵심 기능들을 확인해보세요</p>
        </div>
        <div class="section-content">
          <div class="feature-grid">
            <div class="feature-card">
              <span class="feature-icon">📱</span>
              <h3>터치 제스처 지원</h3>
              <p>모바일 기기에서 직관적인 핀치 줌 제스처를 지원합니다</p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">🎨</span>
              <h3>커스터마이징</h3>
              <p>
                배경색, 최대/최소 스케일 등 다양한 옵션을 설정할 수 있습니다
              </p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">🌐</span>
              <h3>크로스 브라우저</h3>
              <p>다양한 브라우저와 기기에서 안정적으로 동작합니다</p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">⚡</span>
              <h3>경량화</h3>
              <p>외부 의존성 없이 순수 JavaScript로 구현되었습니다</p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">🛡️</span>
              <h3>에러 처리</h3>
              <p>강력한 에러 처리와 복구 메커니즘을 제공합니다</p>
            </div>
            <div class="feature-card">
              <span class="feature-icon">📦</span>
              <h3>NPM 지원</h3>
              <p>NPM 패키지로 쉽게 설치하고 사용할 수 있습니다</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 기본 사용법 섹션 -->
      <div class="section">
        <div class="section-header">
          <h2>🚀 기본 사용법</h2>
          <p>간단한 코드로 핀치 줌 기능을 추가해보세요</p>
        </div>
        <div class="section-content">
          <div class="code-example">
            <pre><code>// ES6 모듈 방식
import { PinchZoom } from './src/index.js';

// 단일 이미지에 적용
const pinchZoom = new PinchZoom('#my-image');

// 여러 이미지에 적용
const galleryZoom = new PinchZoom('.gallery img', {
  backgroundColor: 'rgba(0, 0, 0, 0.8)',
  maxScale: 4
});

// 팩토리 함수 사용
import { createPinchZoom } from './src/index.js';
const zoom = createPinchZoom('.image', options);</code></pre>
          </div>
        </div>
      </div>

      <!-- 단일 이미지 데모 -->
      <div class="section">
        <div class="section-header">
          <h2>📸 단일 이미지 데모</h2>
          <p>하나의 이미지에 핀치 줌을 적용한 예제입니다</p>
        </div>
        <div class="section-content">
          <img
            id="single-image"
            class="demo-image"
            src="https://picsum.photos/600/400?random=1"
            alt="단일 이미지 데모"
          />
          <div class="code-example">
            <pre><code>const singleImage = new PinchZoom('#single-image', {
  backgroundColor: 'rgba(0, 0, 0, 0.7)',
  maxScale: 3,
  transitionDuration: '0.3s'
});</code></pre>
          </div>
        </div>
      </div>

      <!-- 갤러리 데모 -->
      <div class="section">
        <div class="section-header">
          <h2>🖼️ 이미지 갤러리 데모</h2>
          <p>여러 이미지에 동시에 핀치 줌을 적용한 예제입니다</p>
        </div>
        <div class="section-content">
          <div class="gallery">
            <div class="gallery-item">
              <img
                class="gallery-image"
                src="https://picsum.photos/400/300?random=2"
                alt="갤러리 이미지 1"
              />
            </div>
            <div class="gallery-item">
              <img
                class="gallery-image"
                src="https://picsum.photos/400/300?random=3"
                alt="갤러리 이미지 2"
              />
            </div>
            <div class="gallery-item">
              <img
                class="gallery-image"
                src="https://picsum.photos/400/300?random=4"
                alt="갤러리 이미지 3"
              />
            </div>
            <div class="gallery-item">
              <img
                class="gallery-image"
                src="https://picsum.photos/400/300?random=5"
                alt="갤러리 이미지 4"
              />
            </div>
            <div class="gallery-item">
              <img
                class="gallery-image"
                src="https://picsum.photos/400/300?random=6"
                alt="갤러리 이미지 5"
              />
            </div>
            <div class="gallery-item">
              <img
                class="gallery-image"
                src="https://picsum.photos/400/300?random=7"
                alt="갤러리 이미지 6"
              />
            </div>
          </div>
          <div class="code-example">
            <pre><code>const gallery = new PinchZoom('.gallery-image', {
  backgroundColor: 'rgba(255, 255, 255, 0.9)',
  maxScale: 4,
  minScale: 1
});</code></pre>
          </div>
        </div>
      </div>

      <!-- 커스텀 옵션 데모 -->
      <div class="section">
        <div class="section-header">
          <h2>⚙️ 커스텀 옵션 데모</h2>
          <p>다양한 설정 옵션을 적용한 예제들입니다</p>
        </div>
        <div class="section-content">
          <div class="responsive-demo">
            <img
              id="custom-red"
              src="https://picsum.photos/300/200?random=8"
              alt="빨간 배경 데모"
            />
            <img
              id="custom-blue"
              src="https://picsum.photos/300/200?random=9"
              alt="파란 배경 데모"
            />
            <img
              id="custom-green"
              src="https://picsum.photos/300/200?random=10"
              alt="초록 배경 데모"
            />
            <img
              id="custom-purple"
              src="https://picsum.photos/300/200?random=11"
              alt="보라 배경 데모"
            />
          </div>
          <div class="code-example">
            <pre><code>// 빨간 배경, 높은 확대율
new PinchZoom('#custom-red', {
  backgroundColor: 'rgba(255, 0, 0, 0.6)',
  maxScale: 6
});

// 파란 배경, 빠른 전환
new PinchZoom('#custom-blue', {
  backgroundColor: 'rgba(0, 100, 255, 0.5)',
  transitionDuration: '0.1s'
});

// 초록 배경, 제한된 확대
new PinchZoom('#custom-green', {
  backgroundColor: 'rgba(0, 255, 100, 0.4)',
  maxScale: 2
});

// 보라 배경, 높은 z-index
new PinchZoom('#custom-purple', {
  backgroundColor: 'rgba(128, 0, 255, 0.7)',
  zIndex: 9999
});</code></pre>
          </div>
        </div>
      </div>

      <!-- 에러 처리 데모 -->
      <div class="section">
        <div class="section-header">
          <h2>🛡️ 에러 처리 데모</h2>
          <p>라이브러리의 강력한 에러 처리 기능을 확인해보세요</p>
        </div>
        <div class="section-content">
          <div class="error-demo">
            <div
              id="non-image-element"
              style="
                width: 200px;
                height: 150px;
                background: linear-gradient(45deg, #ff6b6b, #feca57);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto;
                color: white;
                font-weight: bold;
              "
            >
              이미지가 아닌 요소
            </div>
          </div>
          <p style="text-align: center; color: #666; margin-top: 15px">
            위 요소는 이미지가 아니므로 PinchZoom이 적용되지 않습니다.
            라이브러리는 이런 경우를 감지하고 경고 메시지를 출력합니다.
          </p>
        </div>
      </div>

      <!-- 컨트롤 패널 -->
      <div class="section">
        <div class="section-header">
          <h2>🎮 인터랙티브 컨트롤</h2>
          <p>라이브러리의 다양한 기능들을 직접 테스트해보세요</p>
        </div>
        <div class="section-content">
          <div class="controls">
            <h3>기본 컨트롤</h3>
            <div class="button-group">
              <button class="btn btn-primary" onclick="initializePinchZoom()">
                🚀 PinchZoom 초기화
              </button>
              <button class="btn btn-secondary" onclick="destroyPinchZoom()">
                🗑️ PinchZoom 제거
              </button>
              <button class="btn btn-warning" onclick="updateOptions()">
                ⚙️ 옵션 업데이트
              </button>
            </div>

            <h3>상태 및 진단</h3>
            <div class="button-group">
              <button class="btn btn-info" onclick="showState()">
                📊 상태 확인
              </button>
              <button class="btn btn-success" onclick="healthCheck()">
                🏥 건강 상태 확인
              </button>
              <button class="btn btn-info" onclick="testCompatibility()">
                🔍 브라우저 호환성 테스트
              </button>
            </div>

            <h3>고급 테스트</h3>
            <div class="button-group">
              <button class="btn btn-danger" onclick="testErrorHandling()">
                🧪 에러 처리 테스트
              </button>
              <button class="btn btn-warning" onclick="performanceTest()">
                ⚡ 성능 테스트
              </button>
              <button class="btn btn-info" onclick="memoryTest()">
                🧠 메모리 테스트
              </button>
            </div>

            <h3>데모 컨트롤</h3>
            <div class="button-group">
              <button class="btn btn-primary" onclick="initializeCustomDemos()">
                🎨 커스텀 데모 초기화
              </button>
              <button class="btn btn-success" onclick="testAllFeatures()">
                ✅ 전체 기능 테스트
              </button>
              <button class="btn btn-secondary" onclick="resetAllDemos()">
                🔄 모든 데모 리셋
              </button>
            </div>
          </div>

          <div id="status" class="status">
            <strong>상태:</strong> 페이지가 로드되었습니다. "PinchZoom 초기화"
            버튼을 클릭하여 시작하세요.
          </div>
        </div>
      </div>

      <!-- API 문서 섹션 -->
      <div class="section">
        <div class="section-header">
          <h2>📚 API 문서</h2>
          <p>PinchZoom 라이브러리의 모든 API를 확인하세요</p>
        </div>
        <div class="section-content">
          <h3>생성자 (Constructor)</h3>
          <div class="code-example">
            <pre><code>new PinchZoom(target, options)

// 매개변수:
// - target: string | Element | NodeList
//   CSS 선택자, DOM 요소, 또는 NodeList
// - options: Object (선택사항)
//   설정 옵션 객체</code></pre>
          </div>

          <h3>설정 옵션 (Configuration Options)</h3>
          <div class="code-example">
            <pre><code>const options = {
  backgroundColor: 'rgba(255, 255, 255, 0.8)', // 오버레이 배경색
  maxScale: 5,                                  // 최대 확대 배율
  minScale: 1,                                  // 최소 확대 배율
  transitionDuration: '0.3s',                   // 전환 애니메이션 시간
  zIndex: 1000                                  // 오버레이 z-index
};</code></pre>
          </div>

          <h3>메서드 (Methods)</h3>
          <div class="code-example">
            <pre><code>// 초기화
pinchZoom.init()

// 옵션 업데이트
pinchZoom.updateOptions(newOptions)

// 제거 및 정리
pinchZoom.destroy()

// 상태 정보 조회
pinchZoom.getState()

// 초기화 에러 조회
pinchZoom.getInitializationErrors()

// 특정 요소의 인스턴스 조회
pinchZoom.getInstance(element)

// 건강 상태 확인
pinchZoom.healthCheck()</code></pre>
          </div>

          <h3>팩토리 함수 (Factory Functions)</h3>
          <div class="code-example">
            <pre><code>// 기본 팩토리 함수
import { createPinchZoom } from './src/index.js';
const zoom = createPinchZoom(target, options);

// 안전한 생성 함수 (에러를 던지지 않음)
import { safePinchZoom } from './src/index.js';
const result = safePinchZoom(target, options);
// result: { success: boolean, instance: PinchZoom|null, error: string|null }</code></pre>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import {
        PinchZoom,
        createPinchZoom,
        safePinchZoom,
      } from "./src/index.js";

      // 인스턴스 저장소
      let instances = {
        single: null,
        gallery: null,
        customRed: null,
        customBlue: null,
        customGreen: null,
        customPurple: null,
      };

      // 전역 함수들을 window 객체에 추가
      window.initializePinchZoom = function () {
        try {
          updateStatus("🚀 PinchZoom 초기화 중...", "info");

          // 기존 인스턴스 정리
          destroyAllInstances();

          // 단일 이미지 초기화
          instances.single = new PinchZoom("#single-image", {
            backgroundColor: "rgba(0, 0, 0, 0.7)",
            maxScale: 3,
          });

          // 갤러리 이미지들 초기화
          instances.gallery = createPinchZoom(".gallery-image", {
            backgroundColor: "rgba(255, 255, 255, 0.9)",
            maxScale: 4,
          });

          updateStatus(
            "✅ PinchZoom이 성공적으로 초기화되었습니다.",
            "success"
          );
        } catch (error) {
          updateStatus("❌ 초기화 중 오류 발생: " + error.message, "error");
          console.error("PinchZoom 초기화 오류:", error);
        }
      };

      window.initializeCustomDemos = function () {
        try {
          updateStatus("🎨 커스텀 데모 초기화 중...", "info");

          // 커스텀 데모들 초기화
          instances.customRed = new PinchZoom("#custom-red", {
            backgroundColor: "rgba(255, 0, 0, 0.6)",
            maxScale: 6,
          });

          instances.customBlue = new PinchZoom("#custom-blue", {
            backgroundColor: "rgba(0, 100, 255, 0.5)",
            transitionDuration: "0.1s",
          });

          instances.customGreen = new PinchZoom("#custom-green", {
            backgroundColor: "rgba(0, 255, 100, 0.4)",
            maxScale: 2,
          });

          instances.customPurple = new PinchZoom("#custom-purple", {
            backgroundColor: "rgba(128, 0, 255, 0.7)",
            zIndex: 9999,
          });

          updateStatus("🎨 커스텀 데모가 초기화되었습니다.", "success");
        } catch (error) {
          updateStatus(
            "❌ 커스텀 데모 초기화 중 오류 발생: " + error.message,
            "error"
          );
          console.error("커스텀 데모 초기화 오류:", error);
        }
      };

      window.destroyPinchZoom = function () {
        try {
          destroyAllInstances();
          updateStatus(
            "🗑️ 모든 PinchZoom 인스턴스가 제거되었습니다.",
            "success"
          );
        } catch (error) {
          updateStatus("❌ 제거 중 오류 발생: " + error.message, "error");
          console.error("PinchZoom 제거 오류:", error);
        }
      };

      window.updateOptions = function () {
        try {
          let updateCount = 0;

          Object.entries(instances).forEach(([key, instance]) => {
            if (instance) {
              instance.updateOptions({
                backgroundColor: "rgba(255, 0, 0, 0.5)",
                maxScale: 5,
              });
              updateCount++;
            }
          });

          updateStatus(
            `⚙️ ${updateCount}개 인스턴스의 옵션이 업데이트되었습니다.`,
            "success"
          );
        } catch (error) {
          updateStatus(
            "❌ 옵션 업데이트 중 오류 발생: " + error.message,
            "error"
          );
          console.error("옵션 업데이트 오류:", error);
        }
      };

      window.showState = function () {
        try {
          const states = [];
          let totalInstances = 0;
          let totalErrors = 0;

          Object.entries(instances).forEach(([key, instance]) => {
            if (instance) {
              const state = instance.getState();
              totalInstances += state.instanceCount;
              totalErrors += state.initializationErrors.length;

              states.push(`${key}: ${state.instanceCount}개 인스턴스`);
            }
          });

          if (states.length === 0) {
            updateStatus(
              "📊 활성화된 PinchZoom 인스턴스가 없습니다.",
              "warning"
            );
          } else {
            const message = `📊 총 ${totalInstances}개 인스턴스 활성화 (${states.join(
              ", "
            )})`;
            updateStatus(
              message + (totalErrors > 0 ? ` - ${totalErrors}개 에러` : ""),
              "info"
            );
          }

          // 상세 정보를 콘솔에 출력
          console.log("=== PinchZoom 상태 정보 ===");
          Object.entries(instances).forEach(([key, instance]) => {
            if (instance) {
              console.log(`${key}:`, instance.getState());
            }
          });
        } catch (error) {
          updateStatus("❌ 상태 확인 중 오류 발생: " + error.message, "error");
          console.error("상태 확인 오류:", error);
        }
      };

      window.testErrorHandling = function () {
        try {
          updateStatus("🧪 오류 처리 테스트 시작...", "info");

          const tests = [
            {
              name: "잘못된 선택자",
              test: () => safePinchZoom("invalid[selector", {}),
            },
            {
              name: "null 대상",
              test: () => safePinchZoom(null, {}),
            },
            {
              name: "이미지가 아닌 요소",
              test: () => safePinchZoom("#non-image-element", {}),
            },
            {
              name: "잘못된 옵션",
              test: () =>
                safePinchZoom("#single-image", {
                  maxScale: "invalid",
                  backgroundColor: 123,
                  minScale: 5,
                  zIndex: -1,
                }),
            },
            {
              name: "존재하지 않는 요소",
              test: () => safePinchZoom("#non-existent-element", {}),
            },
          ];

          console.log("=== 오류 처리 테스트 결과 ===");
          tests.forEach((testCase, index) => {
            console.log(`${index + 1}. ${testCase.name}:`);
            const result = testCase.test();
            console.log("   결과:", result);
          });

          updateStatus(
            "🧪 오류 처리 테스트 완료. 콘솔을 확인하세요.",
            "success"
          );
        } catch (error) {
          updateStatus(
            "❌ 오류 처리 테스트 중 예외 발생: " + error.message,
            "error"
          );
          console.error("오류 처리 테스트 예외:", error);
        }
      };

      window.healthCheck = function () {
        try {
          const healthResults = [];
          let totalRecommendations = 0;

          console.log("=== 건강 상태 확인 ===");
          Object.entries(instances).forEach(([key, instance]) => {
            if (instance) {
              const health = instance.healthCheck();
              healthResults.push(`${key}: ${health.status}`);
              totalRecommendations += health.recommendations.length;

              console.log(`${key} 건강 상태:`, health);
            }
          });

          if (healthResults.length === 0) {
            updateStatus(
              "🏥 건강 상태를 확인할 인스턴스가 없습니다.",
              "warning"
            );
          } else {
            const message = `🏥 ${healthResults.join(" | ")}`;
            updateStatus(
              message +
                (totalRecommendations > 0
                  ? ` (${totalRecommendations}개 권장사항)`
                  : ""),
              "info"
            );
          }
        } catch (error) {
          updateStatus(
            "❌ 건강 상태 확인 중 오류 발생: " + error.message,
            "error"
          );
          console.error("건강 상태 확인 오류:", error);
        }
      };

      window.testCompatibility = function () {
        try {
          updateStatus("🔍 브라우저 호환성 테스트 시작...", "info");

          import("./src/utils.js").then((utils) => {
            const compatibility = utils.getBrowserCompatibility();
            const legacyBrowser = utils.detectLegacyBrowser();

            console.log("=== 브라우저 호환성 정보 ===");
            console.log("User Agent:", compatibility.userAgent);
            console.log("Platform:", compatibility.platform);
            console.log("Modern Browser:", compatibility.isModernBrowser);
            console.log("CSS Transform 지원:", compatibility.transform);
            console.log("Touch Events 지원:", compatibility.touch);
            console.log("기타 기능 지원:", {
              requestAnimationFrame: compatibility.requestAnimationFrame,
              addEventListener: compatibility.addEventListener,
              querySelector: compatibility.querySelector,
              getComputedStyle: compatibility.getComputedStyle,
            });
            console.log("레거시 브라우저 감지:", legacyBrowser);
            console.log("권장사항:", compatibility.recommendations);

            const supportLevel = legacyBrowser.isLegacy
              ? legacyBrowser.supportLevel
              : "full";
            const transformSupport = compatibility.transform.supported
              ? "✅"
              : "❌";
            const touchSupport = compatibility.touch.supported ? "✅" : "❌";

            updateStatus(
              `🔍 호환성: ${supportLevel} | Transform: ${transformSupport} | Touch: ${touchSupport}`,
              "info"
            );
          });
        } catch (error) {
          updateStatus(
            "❌ 호환성 테스트 중 오류 발생: " + error.message,
            "error"
          );
          console.error("호환성 테스트 오류:", error);
        }
      };

      window.performanceTest = function () {
        try {
          updateStatus("⚡ 성능 테스트 시작...", "info");

          const startTime = performance.now();

          // 대량의 이미지 요소 생성 및 초기화 테스트
          const testContainer = document.createElement("div");
          testContainer.style.display = "none";
          document.body.appendChild(testContainer);

          const imageCount = 50;
          const images = [];

          for (let i = 0; i < imageCount; i++) {
            const img = document.createElement("img");
            img.src = `https://picsum.photos/100/100?random=${i + 100}`;
            img.className = "perf-test-image";
            testContainer.appendChild(img);
            images.push(img);
          }

          // 초기화 시간 측정
          const initStartTime = performance.now();
          const perfTestInstance = new PinchZoom(".perf-test-image", {
            backgroundColor: "rgba(0, 0, 0, 0.5)",
            maxScale: 2,
          });
          const initEndTime = performance.now();

          // 정리
          perfTestInstance.destroy();
          document.body.removeChild(testContainer);

          const totalTime = performance.now() - startTime;
          const initTime = initEndTime - initStartTime;

          console.log("=== 성능 테스트 결과 ===");
          console.log(`이미지 수: ${imageCount}개`);
          console.log(`총 소요 시간: ${totalTime.toFixed(2)}ms`);
          console.log(`초기화 시간: ${initTime.toFixed(2)}ms`);
          console.log(
            `이미지당 평균 시간: ${(initTime / imageCount).toFixed(2)}ms`
          );

          updateStatus(
            `⚡ 성능 테스트 완료: ${imageCount}개 이미지 ${initTime.toFixed(
              2
            )}ms`,
            "success"
          );
        } catch (error) {
          updateStatus(
            "❌ 성능 테스트 중 오류 발생: " + error.message,
            "error"
          );
          console.error("성능 테스트 오류:", error);
        }
      };

      window.memoryTest = function () {
        try {
          updateStatus("🧠 메모리 테스트 시작...", "info");

          // 메모리 사용량 측정 (가능한 경우)
          const memoryInfo = performance.memory
            ? {
                used: Math.round(
                  performance.memory.usedJSHeapSize / 1024 / 1024
                ),
                total: Math.round(
                  performance.memory.totalJSHeapSize / 1024 / 1024
                ),
                limit: Math.round(
                  performance.memory.jsHeapSizeLimit / 1024 / 1024
                ),
              }
            : null;

          // 메모리 누수 테스트
          const iterations = 100;
          const testResults = [];

          for (let i = 0; i < iterations; i++) {
            const testImg = document.createElement("img");
            testImg.src =
              "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
            testImg.className = "memory-test-img";
            document.body.appendChild(testImg);

            const instance = new PinchZoom(testImg);
            instance.destroy();

            document.body.removeChild(testImg);

            if (i % 20 === 0 && performance.memory) {
              testResults.push({
                iteration: i,
                memory: Math.round(
                  performance.memory.usedJSHeapSize / 1024 / 1024
                ),
              });
            }
          }

          console.log("=== 메모리 테스트 결과 ===");
          if (memoryInfo) {
            console.log("현재 메모리 사용량:", memoryInfo);
          }
          console.log("메모리 누수 테스트:", testResults);
          console.log(`${iterations}회 생성/제거 테스트 완료`);

          const message = memoryInfo
            ? `🧠 메모리 테스트 완료: ${memoryInfo.used}MB 사용 중`
            : "🧠 메모리 테스트 완료 (메모리 정보 불가)";

          updateStatus(message, "success");
        } catch (error) {
          updateStatus(
            "❌ 메모리 테스트 중 오류 발생: " + error.message,
            "error"
          );
          console.error("메모리 테스트 오류:", error);
        }
      };

      window.testAllFeatures = function () {
        try {
          updateStatus("✅ 전체 기능 테스트 시작...", "info");

          const tests = [
            { name: "기본 초기화", fn: initializePinchZoom },
            { name: "커스텀 데모", fn: initializeCustomDemos },
            { name: "상태 확인", fn: showState },
            { name: "건강 상태", fn: healthCheck },
            { name: "호환성 테스트", fn: testCompatibility },
            { name: "에러 처리", fn: testErrorHandling },
          ];

          let completedTests = 0;
          const totalTests = tests.length;

          tests.forEach((test, index) => {
            setTimeout(() => {
              try {
                console.log(`실행 중: ${test.name}`);
                test.fn();
                completedTests++;

                if (completedTests === totalTests) {
                  updateStatus(
                    "✅ 모든 기능 테스트가 완료되었습니다.",
                    "success"
                  );
                }
              } catch (error) {
                console.error(`${test.name} 테스트 실패:`, error);
              }
            }, index * 1000);
          });
        } catch (error) {
          updateStatus(
            "❌ 전체 기능 테스트 중 오류 발생: " + error.message,
            "error"
          );
          console.error("전체 기능 테스트 오류:", error);
        }
      };

      window.resetAllDemos = function () {
        try {
          destroyAllInstances();
          updateStatus("🔄 모든 데모가 리셋되었습니다.", "success");
        } catch (error) {
          updateStatus("❌ 데모 리셋 중 오류 발생: " + error.message, "error");
          console.error("데모 리셋 오류:", error);
        }
      };

      // 유틸리티 함수들
      function destroyAllInstances() {
        Object.keys(instances).forEach((key) => {
          if (instances[key]) {
            instances[key].destroy();
            instances[key] = null;
          }
        });
      }

      function updateStatus(message, type = "info") {
        const statusElement = document.getElementById("status");
        statusElement.className = `status ${type}`;
        statusElement.innerHTML = `<strong>상태:</strong> ${message}`;
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      // 페이지 로드 이벤트
      document.addEventListener("DOMContentLoaded", function () {
        updateStatus(
          '📱 페이지가 로드되었습니다. "PinchZoom 초기화" 버튼을 클릭하여 시작하세요.',
          "info"
        );
      });

      // 이미지 로드 완료 후 자동 초기화
      window.addEventListener("load", function () {
        setTimeout(() => {
          initializePinchZoom();
        }, 1000);
      });
    </script>
  </body>
</html>
